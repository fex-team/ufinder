!function($,window){var UFinder=window.UF=window.UFinder=function(){var a={},b=0;return{version:"1.0.0",createFinder:function(a,b){b=b||{},b.renderTo=Utils.isString(a)?document.getElementById(a):a;var c=new Finder(b);return this.addFinder(b.renderTo,c),c},addFinder:function(c,d){var e;e="string"==typeof c?c:c.id||"UF_INSTANCE_"+b++,a[e]=d},getFinder:function(c,d){var e;return e="string"==typeof c?c:c.id||"UF_INSTANCE_"+b++,a[e]||this.createFinder(c,d)},LANG:{}}}(),browser=UF.browser=function(){var a=navigator.userAgent.toLowerCase(),b=window.opera,c={ie:!!window.ActiveXObject,opera:!!b&&b.version,webkit:a.indexOf(" applewebkit/")>-1,mac:a.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};c.gecko="Gecko"==navigator.product&&!c.webkit&&!c.opera;var d=0;if(c.ie&&(d=parseFloat(a.match(/msie (\d+)/)[1]),c.ie9Compat=9==document.documentMode,c.ie8=!!document.documentMode,c.ie8Compat=8==document.documentMode,c.ie7Compat=7==d&&!document.documentMode||7==document.documentMode,c.ie6Compat=7>d||c.quirks,c.ie9above=d>8,c.ie9below=9>d),c.gecko){var e=a.match(/rv:([\d\.]+)/);e&&(e=e[1].split("."),d=1e4*e[0]+100*(e[1]||0)+1*(e[2]||0))}return/chrome\/(\d+\.\d)/i.test(a)&&(c.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(a)&&!/chrome/i.test(a)&&(c.safari=+(RegExp.$1||RegExp.$2)),c.opera&&(d=parseFloat(b.version())),c.webkit&&(d=parseFloat(a.match(/ applewebkit\/(\d+)/)[1])),c.version=d,c.isCompatible=!c.mobile&&(c.ie&&d>=6||c.gecko&&d>=10801||c.opera&&d>=9.5||c.air&&d>=1||c.webkit&&d>=522||!1),c}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;UF.defaultOptions={zIndex:10,lang:"zh-cn"},function(){var a;UF.registerModule=function(b,c){a||(a={}),a[b]=c},UF.getModules=function(){return a}}();var Utils=UFinder.Utils={argsToArray:function(a,b){return Array.prototype.slice.call(a,b||0)},regularDirPath:function(a){return a.replace(/([^\/])$/,"$1/").replace(/^([^\/])/,"/$1")},getParentPath:function(a){return a.replace(/[^\/]+\/?$/,"")},getPathExt:function(a){var b=a.lastIndexOf(".");return a.substr((-1==b?a.length:b)+1)},isImagePath:function(a){return a&&-1!="png gif bmp jpg jpeg".split(" ").indexOf(Utils.getPathExt(a))},isCodePath:function(a){return a&&-1!="txt md json js css html htm xml php asp jsp".split(" ").indexOf(Utils.getPathExt(a))},isWebPagePath:function(a){return a&&-1!="html php asp jsp".split(" ").indexOf(Utils.getPathExt(a))},extend:function(a,b,c){if(b)for(var d in b)c&&a.hasOwnProperty(d)||(a[d]=b[d]);return a},clone:function(a,b){var c;b=b||{};for(var d in a)a.hasOwnProperty(d)&&(c=a[d],"object"==typeof c?(b[d]=Utils.isArray(c)?[]:{},Utils.clone(a[d],b[d])):b[d]=c);return b},loadFile:function(){function a(a,c){try{for(var d,e=0;d=b[e++];)if(d.doc===a&&d.url==(c.src||c.href))return d}catch(f){return null}}var b=[];return function(c,d,e){var f,g=a(c,d);if(g)return void(g.ready?e&&e():g.funs.push(e));if(b.push({doc:c,url:d.src||d.href,funs:[e]}),!c.body){var h=[];for(f in d)"tag"!=f&&h.push(f+'="'+d[f]+'"');return void c.write("<"+d.tag+" "+h.join(" ")+" ></"+d.tag+">")}if(!d.id||!c.getElementById(d.id)){var i=c.createElement(d.tag);delete d.tag;for(f in d)i.setAttribute(f,d[f]);i.onload=i.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(g=a(c,d),g.funs.length>0){g.ready=1;for(var b;b=g.funs.pop();)b()}i.onload=i.onreadystatechange=null}},i.onerror=function(){throw new Error("The load "+(d.href||d.src)+" fails,check the url")},c.getElementsByTagName("head")[0].appendChild(i)}}}()};$.each(["String","Function","Array","Number","RegExp","Object","Boolean"],function(a,b){Utils["is"+b]=function(a){return Object.prototype.toString.apply(a)=="[object "+b+"]"}}),function(){function Class(){}function getCallerClass(a){a.constructor}function checkBaseConstructorCall(a,b){var c=a.toString();if(!/this\.callBase/.test(c))throw new Error(b+" : 类构造函数没有调用父类的构造函数！为了安全，请调用父类的构造函数")}function checkMixinConstructorCall(a,b){var c=a.toString();if(!/this\.callMixin/.test(c))throw new Error(b+" : 类构造函数没有调用父类的构造函数！为了安全，请调用父类的构造函数")}function inherit(constructor,BaseClass,classname){var UFinderClass=eval("(function UFinder"+classname+"( __inherit__flag ) {if( __inherit__flag != FINDER_INHERIT_FLAG ) {UFinderClass.__UFinderConstructor.apply(this, arguments);}this.__UFinderClassName = UFinderClass.__UFinderClassName;})");UFinderClass.__UFinderConstructor=constructor,UFinderClass.prototype=new BaseClass(FINDER_INHERIT_FLAG);for(var methodName in BaseClass.prototype)BaseClass.prototype.hasOwnProperty(methodName)&&0!==methodName.indexOf("__UFinder")&&(UFinderClass.prototype[methodName]=BaseClass.prototype[methodName]);return UFinderClass.prototype.constructor=UFinderClass,UFinderClass}function mixin(a,b){if(!1==b instanceof Array)return a;var c,d,e,f=b.length;for(a.__UFinderMixins={constructor:[]},c=0;f>c;c++){d=b[c].prototype;for(e in d)!1!==d.hasOwnProperty(e)&&0!==e.indexOf("__UFinder")&&("constructor"===e?a.__UFinderMixins.constructor.push(d[e]):a.prototype[e]=a.__UFinderMixins[e]=d[e])}return a}function extend(a,b){b.__UFinderClassName&&(b=b.prototype);for(var c in b)if(b.hasOwnProperty(c)&&c.indexOf("__UFinder")&&"constructor"!=c){var d=a.prototype[c]=b[c];d.__UFinderMethodClass=a,d.__UFinderMethodName=c}return a}var debug=!0;if(Function.prototype.bind=Function.prototype.bind||function(a){var b=Array.prototype.slice.call(arguments,1);return this.apply(a,b)},debug){var origin=Object.prototype.toString;Object.prototype.toString=function(){return this.__UFinderClassName||origin.call(this)}}Class.__UFinderClassName="Class",Class.prototype.base=function(a){var b=arguments.callee.caller,c=b.__UFinderMethodClass.__UFinderBaseClass.prototype[a];return c.apply(this,Array.prototype.slice.call(arguments,1))},Class.prototype.callBase=function(){var a=arguments.callee.caller,b=a.__UFinderMethodClass.__UFinderBaseClass.prototype[a.__UFinderMethodName];return b.apply(this,arguments)},Class.prototype.mixin=function(a){var b=arguments.callee.caller,c=b.__UFinderMethodClass.__UFinderMixins;if(!c)return this;var d=c[a];return d.apply(this,Array.prototype.slice.call(arguments,1))},Class.prototype.callMixin=function(){var a=arguments.callee.caller,b=a.__UFinderMethodName,c=a.__UFinderMethodClass.__UFinderMixins;if(!c)return this;var d=c[b];if("constructor"==b){for(var e=0,f=d.length;f>e;e++)d[e].call(this);return this}return d.apply(this,arguments)},Class.prototype.pipe=function(a){return"function"==typeof a&&a.call(this,this),this},Class.prototype.getType=function(){return this.__UFinderClassName};var FINDER_INHERIT_FLAG="__FINDER_INHERIT_FLAG_"+ +new Date;UF.createClass=function(a,b){var c,d,e;return 1===arguments.length&&(b=arguments[0],a="AnonymousClass"),e=b.base||Class,b.hasOwnProperty("constructor")?(c=b.constructor,e!=Class&&checkBaseConstructorCall(c,a)):c=function(){this.callBase.apply(this,arguments),this.callMixin.apply(this,arguments)},d=inherit(c,e,a),d=mixin(d,b.mixins),d.__UFinderClassName=c.__UFinderClassName=a,d.__UFinderBaseClass=c.__UFinderBaseClass=e,d.__UFinderMethodNames=c.__UFinderMethodName="constructor",d.__UFinderMethodClass=c.__UFinderMethodClass=d,delete b.mixins,delete b.constructor,delete b.base,d=extend(d,b)},UF.extendClass=extend}();var FileNode=UF.FileNode=UF.createClass("FileNode",{constructor:function(a){this.info={},this.parent=null,this.locked=!1,this.children=[],this.setInfo(a)},setInfo:function(a){var b=this,c=["path","name","type","read","write","time","mode","size"];$.each(c,function(c,d){a[d]&&b.setAttr(d,a[d])}),this._regularDirPath()},_regularDirPath:function(){var a=this.info.path.replace(/^([^\/])/,"/$1");this.info.path="dir"==this.getAttr("type")?a.replace(/([^\/])$/,"$1/"):a.replace(/([^\/])$/,"$1")},getInfo:function(){return this.info},setAttr:function(a,b){this.info[a]=b,this._regularDirPath()},getAttr:function(a){return this.info[a]},addChild:function(a){a.parent=this,this.children.push(a)},remove:function(){this.parent&&this.parent.removeChild(this)},removeChild:function(a){a.parent=this,this.children.pop(a)},getChild:function(a){for(var b in this.children)if(this.children[b].getAttr("name")==a)return this.children[b];return null},lock:function(){this.locked=!0},unLock:function(){this.locked=!1}}),Finder=UF.Finder=UF.createClass("Finder",{constructor:function(a){this._options=$.extend(window.UFINDER_CONFIG||{},a),this.setDefaultOptions(UF.defaultOptions),this._initEvents(),this._initSelection(),this._initFinder(),this._initShortcutKey(),this._initModules(),this.fire("finderready")},_initFinder:function(){this.dataTree=new DataTree(this),this.proxy=new Proxy(this),this.isFocused=!1,this.serverOption={realRootUrl:this.getOption("realUrl")},this.setCurrentPath("/")},getCurrentPath:function(){return this._currentPath},setCurrentPath:function(a){"/"!=a.charAt(0)&&(a="/"+a),"/"!=a.charAt(a.length-1)&&(a+="/"),this._currentPath=a,this.fire("currentpathchange",this._currentPath)},setDefaultOptions:function(a,b){var c={};Utils.isString(a)?c[a]=b:c=a,$.extend(this._options,c,!0)},getOption:function(a){return this._options[a]},getLang:function(a){var b=UF.LANG[this.getOption("lang")];if(!b)throw new Error("not import language file");a=(a||"").split(".");for(var c,d=0;(c=a[d++])&&(b=b[c],b););return b},getRealPath:function(a){return(this.serverOption.realRootUrl+a).replace(/([^:])\/\//g,"$1/")}});UF.extendClass(Finder,{_initEvents:function(){this._eventCallbacks={}},_initDomEvent:function(){var a=this,b=a.$container,c=$('<input class="ufui-key-listener">');b.append($('<div class="ufui-event-helper" style="position:absolute;left:0;top:0;height:0;width:0;overflow: hidden;"></div>').append(c)),a._proxyDomEvent=$.proxy(a._proxyDomEvent,a),a._initKeyListener(b,c),$(document).on("keydown keyup keypress",a._proxyDomEvent),b.on("click mousedown mouseup mousemove mouseover mouseout contextmenu selectstart",a._proxyDomEvent)},_proxyDomEvent:function(a){var b=this;if(a.originalEvent){var c=$(a.originalEvent.target);$.each(["tree","list","toolbar"],function(d,e){(c[0]==b["$"+e][0]||c.parents(".ufui-"+e)[0]==b["$"+e][0])&&b.fire(e+"."+a.type.replace(/^on/,""),a)})}return this.fire(a.type.replace(/^on/,""),a)},_initKeyListener:function(a,b){var c=this;a.on("click",function(a){var d=a.target;"INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName&&1!=d.contentEditable&&(b.focus(),0==c.isFocused&&c.setFocus())}),$(document).on("click",function(d){if(d.originalEvent){var e=$(d.originalEvent.target).parents(".ufui-container");e[0]!=a[0]&&(b.blur(),1==c.isFocused&&c.setBlur())}}),c.on("afterexeccommand",function(a,c){-1==["rename","touch","mkdir"].indexOf(c)&&b.focus()})},setFocus:function(){this.isFocused=!0,this.fire("focus")},setBlur:function(){this.isFocused=!1,this.fire("blur")},_listen:function(a,b){var c=this._eventCallbacks[a]||(this._eventCallbacks[a]=[]);c.push(b)},on:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this._listen(c[d].toLowerCase(),b);return this},one:function(a,b){var c=this,d=function(){b(),c.off(a,d)};return c.on(a,d),this},off:function(a,b){var c,d,e,f,g=a.split(" ");for(c=0;c<g.length;c++)if(e=this._eventCallbacks[g[c].toLowerCase()]){for(f=null,d=0;d<e.length;d++)e[d]==b&&(f=d);null!==f&&e.splice(f,1)}},fire:function(a){var b=this._eventCallbacks[a.toLowerCase()];if(b){for(var c=0;c<b.length;c++){var d=b[c].apply(this,arguments);if(0==d)break}return d}}}),UF.extendClass(Finder,{_initShortcutKey:function(){this._shortcutkeys={}},addShortcutKeys:function(a,b){var c={};b?c[a]=b:c=a,$.extend(this._shortcutkeys,c),this._bindshortcutKeys()},_bindshortcutKeys:function(){var a=this,b=a._shortcutkeys;a.on("keydown",function(c,d){var e=d.keyCode||d.which;for(var f in b)for(var g,h=b[f].split(","),i=0;g=h[i++];){g=g.split(":");var j=g[0],k=g[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(j.toLowerCase())||/^(\d+)$/.test(j))&&(("ctrl"==RegExp.$1?d.ctrlKey||d.metaKey:0)&&(""!=RegExp.$2?d[RegExp.$2.slice(1)+"Key"]:1)&&e==RegExp.$3||e==RegExp.$1)&&(-1!=a.queryCommandState(f,k)&&a.execCommand(f,k),d.preventDefault())}})}}),UF.extendClass(Finder,{_initSelection:function(){this._selectedFiles=[]},getSelection:function(){return new Selection(this)},setSelectedFiles:function(a){this._selectedFiles=$.isArray(a)?a:[a],this.fire("selectionchange")}}),UF.extendClass(Finder,{_initModules:function(){var a=UF.getModules();this._commands={},this._query={},this._modules={};var b,c,d,e,f=this;for(b in a)if(a.hasOwnProperty(b)){c=a[b].call(f),this._modules[b]=c,c.init&&c.init.call(f,this._options),d=c.commands;for(var g in d)f._commands[g.toLowerCase()]=d[g];if(c.defaultOptions&&f.setDefaultOptions(c.defaultOptions),e=c.events)for(var h in e)f.on(h,e[h]);c.shortcutKeys&&f.addShortcutKeys(c.shortcutKeys)}}}),UF.extendClass(Finder,{_getCommand:function(a){return this._commands[a.toLowerCase()]},_queryCommand:function(a,b,c){var d=this._getCommand(a);if(d){var e=d["query"+b];if(e)return e.apply(d,[this].concat(c))}return 0},queryCommandState:function(a){return this.isFocused?this._queryCommand(a,"State",Utils.argsToArray(1)):-1},queryCommandValue:function(a){return this._queryCommand(a,"Value",Utils.argsToArray(1))},execCommand:function(a){a=a.toLowerCase();var b,c,d=$.makeArray(arguments).slice(1),e=this;return(b=this._getCommand(a))?(e.fire("beforeexeccommand",a),c=b.execute.apply(e,d),e.fire("afterexeccommand",a),void 0===c?null:c):!1}});var Selection=UF.Selection=UF.createClass("Selection",{constructor:function(a){this.finder=a,this._selectedFiles=a._selectedFiles||[]},getSelectedFile:function(){return this._selectedFiles[0]},getSelectedFiles:function(){return this._selectedFiles},removeSelectedFiles:function(a){var b=this;$.each($.isArray(a)?a:[a],function(a,c){var d;-1!==(d=b._selectedFiles.indexOf(c))&&b._selectedFiles.splice(d,1)})},removeAllSelectedFiles:function(){this._selectedFiles=[]},isFileSelected:function(a){return-1!==this._selectedFiles.indexOf(a)},select:function(){this.finder.fire("selectfiles",this._selectedFiles)}}),DataTree=UF.DataTree=UF.createClass("DataTree",{constructor:function(a){this.finder=a,this.root=null},setRoot:function(a){this.root=new FileNode(a),this.finder.fire("dataReady",a)},_getFileNode:function(a){for(var b=this.root,c=a.split("/"),d=0;d<c.length;d++){var e=c[d];""!=e&&(b=b.getChild(e))}return b},getFileInfo:function(a){var b=this._getFileNode(a);return b?b.getInfo():null},_addFile:function(a){for(var b=this.root,c=$.trim(a.path).replace(/(^\/)|(\/$)/g,"").split("/"),d=0;d<c.length-1;d++){var e=c[d];""!=e&&(b=b.getChild(e))}b&&b.addChild(new FileNode(a))},addFile:function(a){this._addFile(a),this.finder.fire("addFiles",a)},updateFile:function(a,b){var c=this._getFileNode(a);c.path==a?c.setInfo(b):(c.remove(),this._addFile(b)),this.finder.fire("updateFile",a,b)},removeFile:function(a){var b=this._getFileNode(a);b&&b.remove(),this.finder.fire("removeFiles",a)},addFiles:function(a){var b=this;$.each(a,function(a,c){b.addFile(c)})},removeFiles:function(a){var b=this;$.each(a,function(a,c){b.removeFile(c)})},lockFile:function(a){var b=this._getFileNode(a);b&&b.lock(),this.finder.fire("lockfiles",[a])},unLockFile:function(a){var b=this._getFileNode(a);b&&b.unLock(),this.finder.fire("unlockfiles",[a])},lockFiles:function(a){var b=this;$.each(a,function(a,c){b.lockFile(c)})},unLockFiles:function(a){var b=this;$.each(a,function(a,c){b.unLockFile(c)})},listDirFileInfo:function(a){var b=[],c=this._getFileNode(a);return $.each(c.children,function(a,c){b.push(c.getInfo())}),b},isFileLocked:function(a){return this._getFileNode(a).locked}}),Request=UF.Request=UF.createClass("Request",{constructor:function(a,b){this.id="r"+(+new Date).toString(36),this.data=a,this.jqXhr=null,this.callback=b},send:function(){var me=this;me.jqXhr=$.ajax(me.data).always(function(r){try{me.responseJson=JSON?JSON.parse(r):eval(r)}catch(e){me.responseJson=null}me.responseText=r,console.log(me.responseJson||r),me.callback&&me.callback(me.responseJson)})},abort:function(){this.cancel()},cancel:function(){this.jqXhr&&this.jqXhr.abort()},callback:function(){}}),Uploader=UF.Uploader=UF.createClass("Uploader",{constructor:function(a,b){this.id="r"+(+new Date).toString(36),this.data=a,this.webuploader=a.webuploader,this.callback=b,this.process=a.process,this.file=a.data.file,this._initEvents()},_initEvents:function(){var me=this,r,handler=function(file){if(file.id==me.file.id){console.log(r);try{me.responseJson=JSON?JSON.parse(r):eval(r)}catch(e){me.responseJson=null}me.responseText=r,me.webuploader.stop(),me.callback&&me.callback(me.responseJson),me.webuploader.off("uploadComplete",handler)}};me.webuploader.on("uploadProgress",function(a,b){me.process&&me.process(b)}),me.webuploader.on("uploadSuccess",function(a,b){r=b._raw}),me.webuploader.on("uploadError",function(a,b){r=b._raw}),me.webuploader.on("uploadComplete",handler)},send:function(){this.webuploader.option("formdata",{cmd:"upload",target:this.data.data.target}),this.webuploader.upload(this.file)},pause:function(){this.webuploader.stop()},cancel:function(){this.webuploader.stop(!0)}}),Proxy=UF.Proxy=UF.createClass("Proxy",{constructor:function(a){this.finder=a,this._queue=[],this.active=!1,this.nextSendIndex=0,this._url=a.getOption("serverUrl")},init:function(a){return this._get({cmd:"init"},a)},getRequestUrl:function(a){var b=this._url+"?";return $.each(a||{},function(a,c){b+=a+"="+c+"&"}),"&"==b.charAt(b.length-1)&&(b=b.substr(0,b.length-1)),"?"==b.charAt(b.length-1)&&(b=b.substr(0,b.length-1)),b},ls:function(a,b){return this._get({cmd:"ls",target:a},b)},rename:function(a,b,c){return this._get({cmd:"rename",target:a,name:b},c)},touch:function(a,b){return this._get({cmd:"touch",target:a},b)},mkdir:function(a,b){return this._get({cmd:"mkdir",target:a},b)},rm:function(a,b){return this._get({cmd:"rm",target:a},b)},upload:function(a,b,c){return this._upload({cmd:"upload",target:a,file:b},c,b)},info:function(a,b){return this._get({cmd:"info",target:a},b)},_get:function(a,b){return this._ajax("GET",a,b)},_post:function(a,b){return this._ajax("POST",a,b)},_upload:function(a,b){return this._ajax("UPLOAD",a,b)},_ajax:function(a,b,c){var d,e=this,f=function(a){e._beforeRequestComplete(a,d),c&&c(a,d),e._afterRequestComplete(a,d)};return d="UPLOAD"==a?new Uploader({url:e._url,type:a,webuploader:e.finder.webuploader,data:b,process:function(a){e.finder.fire("updatemessage",{loadedPercent:a,request:d,id:d.id})}},f):new Request({url:e._url,type:a,data:b},f),e._pushRequest(d),e.finder.fire("showmessage",{icon:"loading",title:b.cmd+" loading...",loadedPercent:100,request:d,id:d.id}),d},_pushRequest:function(a){this._queue.push(a),this._sendRequest()},_sendRequest:function(){!this.active&&this.nextSendIndex<this._queue.length&&(this.active=!0,this._queue[this.nextSendIndex++].send())},_beforeRequestComplete:function(a,b){this.finder.fire("beforeRequestComplete",a,b),this.finder.fire("hidemessage",{id:b.id}),this.active=!1,this._sendRequest()},_afterRequestComplete:function(a,b){this.finder.fire("afterRequestComplete",a,b)}});UF.registerModule("openmodule",function(){var a=this,b=function(b,c){void 0===b?b=a.getSelection().getSelectedFile():""==b&&(b="/");var d=a.dataTree.listDirFileInfo(b),e=function(d){var e=d&&d.data&&d.data.files||[];a.dataTree.addFiles(e),c&&a.setCurrentPath(b)};d&&d.length?e(d):a.proxy.ls(b,e)},c=function(){var b,c;return b=a.getSelection().getSelectedFiles(),1==b.length?(c=a.dataTree.getFileInfo(b[0]),c&&c.read&&!a.dataTree.isFileLocked(b[0])?0:-1):-1};return{init:function(){},defaultOptions:{},commands:{open:{execute:function(c){void 0===c?c=a.getSelection().getSelectedFile():""==c&&(c="/"),b(c,!0)},queryState:c},list:{execute:function(a){b(a,!1)},queryState:c}},events:{}}}),UF.registerModule("addfilemodule",function(){var a=this;return{init:function(){},defaultOptions:{},commands:{touch:{execute:function(){a.fire("newFileTitle","",function(b,c){console.log("|******** touch done ********|");var d=a.getCurrentPath()+b;b&&a.proxy.touch(d,function(b){if(c&&c(0==b.state),0==b.state){var d=b&&b.data&&b.data.file;a.dataTree.addFile(d),a.fire("selectfiles",d.path)}else a.fire("showmessage",{title:b.message,timeout:3e3})})})},queryState:function(){var b,c=a.getCurrentPath();return b=a.dataTree.getFileInfo(c),b&&b.write&&!a.dataTree.isFileLocked(c)?0:-1}},mkdir:{execute:function(){a.fire("newFileTitle","dir",function(b,c){console.log("|******** mkdir done ********|");var d=a.getCurrentPath()+b;b&&a.proxy.mkdir(d,function(b){if(c&&c(0==b.state),0==b.state){var d=b&&b.data&&b.data.file;a.dataTree.addFile(d),a.fire("selectfiles",d.path)}else a.fire("showmessage",{title:b.message,timeout:3e3})})})},queryState:function(){var b,c=a.getCurrentPath();return b=a.dataTree.getFileInfo(c),b&&b.write&&!a.dataTree.isFileLocked(c)?0:-1}}},shortcutKeys:{touch:"ctrl+78"},events:{}}}),UF.registerModule("removemodule",function(){var a=this;return{defaultOptions:{},commands:{remove:{execute:function(){var b=a.getSelection().getSelectedFiles();if(b.length){a.dataTree.lockFiles(b);var c=a.proxy.rm(b,function(d){0==d.state?(a.dataTree.removeFiles(b),a.fire("removefiles",b)):a.fire("updatemessage",{title:d.message,timeout:3e3,id:c.id}),a.dataTree.unLockFiles(b)})}},queryState:function(){var b=a.getSelection().getSelectedFiles();if(b.length>0){for(var c in b){var d=a.dataTree.getFileInfo(b[c]);if(d&&(!d.write||a.dataTree.isFileLocked(b[c])))return-1}return 0}return-1}}},shortcutKeys:{remove:"46"},events:{}}}),UF.registerModule("renamemodule",function(){var a=this;return{defaultOptions:{},commands:{rename:{execute:function(){var b,c=a.getSelection().getSelectedFile();c&&a.fire("renameFileTitle",c,function(d,e){if(console.log("|******** rename done ********|"),b=a.getCurrentPath()+d,d&&c!=b){a.dataTree.lockFile(c);var f=a.proxy.rename(c,b,function(b){if(e&&e(0==b.state),0==b.state){var d=b&&b.data&&b.data.file;a.dataTree.updateFile(c,d),a.fire("selectfiles",d.path)}else a.fire("updatemessage",{title:b.message,timeout:3e3,id:f.id});a.dataTree.unLockFile(c)})}})},queryState:function(){var b,c;return b=a.getSelection().getSelectedFiles(),1==b.length?(c=a.dataTree.getFileInfo(b[0]),c&&c.write&&!a.dataTree.isFileLocked(b[0])?0:-1):-1}}},shortcutKeys:{rename:browser.mac?"13":"113"},events:{}}}),UF.registerModule("selectmodule",function(){var a=this;return{init:function(){},defaultOptions:{},commands:{selectall:{execute:function(){var b=a.getCurrentPath(),c=a.dataTree.listDirFileInfo(b),d=[];$.each(c,function(a,b){d.push(b.path)}),a.fire("selectfiles",d)},queryState:function(){}},selectnext:{execute:function(){},queryState:function(){}},selectprevious:{execute:function(){},queryState:function(){}}},shortcutKeys:{},events:{"list.click":function(){}}}}),UF.registerModule("uploadmodule",function(){var a=this,b=function(){var b=((+new Date).toString(36),a.webuploader=WebUploader.create({swf:a.getOption("uploaderSwfUrl"),server:a.getOption("serverUrl")+"?cmd=upload&target="+a.getCurrentPath(),resize:!1,threads:1,fileVal:a.getOption("uploaderFileName"),formdata:{},duplicate:!1}));b.on("fileQueued",function(b){a.execCommand("upload",b)}),a.fire("initUploader")};return{init:function(){},defaultOptions:{uploaderFileName:"file",uploaderSwfUrl:a.getOption("URL")+"/lib/webuploader/Uploader.swf",uploaderJsUrl:a.getOption("URL")+"/lib/webuploader/webuploader.js"},commands:{upload:{execute:function(b){b&&a.proxy.upload(a.getCurrentPath(),b,function(b){if(0==b.state){var c=b&&b.data&&b.data.file;a.dataTree.addFile(c),a.fire("selectfiles",c.path)}else a.fire("showmessage",{title:b.message,timeout:3e3})})},queryState:function(){var b,c=a.getCurrentPath();return b=a.dataTree.getFileInfo(c),b&&b.write&&!a.dataTree.isFileLocked(c)?0:-1}}},events:{ready:function(){var c=a.$container[0].ownerDocument;Utils.loadFile(c,{src:a.getOption("uploaderJsUrl"),tag:"script",type:"text/javascript",defer:"defer"},b)},currentpathchange:function(b,c){a.webuploader&&a.webuploader.option("server",a.getOption("URL")+"/server/ufinder.php?cmd=upload&target="+c)}}}}),UF.registerModule("lookimagemodule",function(){var a=this;return{commands:{lookimage:{execute:function(b){a.fire("selectFiles",b),a.$toolbar.find(".ufui-btn-lookimage").trigger("click")},queryState:function(){var b=a.getSelection().getSelectedFile();return Utils.isImagePath(b)?0:-1}}}}}),UF.registerModule("lookcodemodule",function(){var a=this;return{commands:{lookcode:{execute:function(b){a.fire("selectFiles",b),a.$toolbar.find(".ufui-btn-lookcode").trigger("click")},queryState:function(){var b=a.getSelection().getSelectedFile();return Utils.isCodePath(b)?0:-1}}}}}),UF.registerModule("pathchangemodule",function(){var a=this;return{init:function(){a._pathHistory=[],a._pathHistoryIndex=0},commands:{pathparent:{execute:function(){var b=a.getCurrentPath(),c=Utils.getParentPath(b);a.setCurrentPath(c)},queryState:function(){return a.getCurrentPath().length>2?0:-1}},pathbackward:{execute:function(){a._pathHistoryIndex>0&&a.setCurrentPath(a._pathHistory[a._pathHistoryIndex--])},queryState:function(){return a._pathHistoryIndex>1?0:-1}},pathforward:{execute:function(){},queryState:function(){return a._pathHistory.length>a._pathHistoryIndex+1?0:-1}}},events:{currentPathChange:function(b,c){a._pathHistory.splice(a._pathHistoryIndex,a._pathHistory.length,c)}}}}),UF.registerModule("downloadmodule",function(){var a=this;return{commands:{download:{execute:function(b){a.fire("selectFiles",b);var c=a.proxy.getRequestUrl({cmd:"download",target:b}),d=$('<iframe src="'+c+'">').hide().appendTo(document.body).load(function(){setTimeout(function(){d.remove()},3e3)})},queryState:function(){var b=a.getSelection().getSelectedFile(),c=a.dataTree.getFileInfo(b);return c&&"dir"!=c.type?0:-1}}}}}),UF.registerModule("initmodule",function(){var a=this;return{init:function(){},commands:{init:{execute:function(){a.proxy.init(function(b){a.dataTree.setRoot(b.data.root)})}}},events:{ready:function(){a.execCommand("init")},dataReady:function(){a.execCommand("open","/")}}}}),function(a){function b(b,c,d){if(b.prototype=a.extend2(a.extend({},c),(UF.ui[d]||e).prototype,!0),b.prototype.supper=(UF.ui[d]||e).prototype,UF.ui[d]&&UF.ui[d].prototype.defaultOpt){var f=UF.ui[d].prototype.defaultOpt,g=b.prototype.defaultOpt;b.prototype.defaultOpt=a.extend({},f,g||{})}return b}function c(b,c){a[f+c]=b,a.fn[f+c]=function(c){var d,e=Array.prototype.slice.call(arguments,1);return this.each(function(f,g){var h=a(g),i=h.ufui();if(i||(new b(c&&a.isPlainObject(c)?c:{},h),h.ufui(i)),"string"==a.type(c))if("this"==c)d=i;else{if(d=i[c].apply(i,e),d!==i&&void 0!==d)return!1;d=null}}),null!==d?d:this}}a.parseTmpl=function(a,b){var c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",d=new Function("obj",c);return b?d(b):d},a.extend2=function(b){for(var c=arguments,d="boolean"==a.type(c[c.length-1])?c[c.length-1]:!1,e="boolean"==a.type(c[c.length-1])?c.length-1:c.length,f=1;e>f;f++){var g=c[f];for(var h in g)d&&b.hasOwnProperty(h)||(b[h]=g[h])}return b},a.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);var d=[],e=function(){},f="ufui";e.prototype={on:function(b,c){return this.root().on(b,a.proxy(c,this)),this},off:function(b,c){return this.root().off(b,a.proxy(c,this)),this},trigger:function(a,b){return this.root().trigger(a,b)===!1?!1:this},root:function(a){return this._$el||(this._$el=a)},destroy:function(){},data:function(a,b){return void 0!==b?(this.root().data(f+a,b),this):this.root().data(f+a)},register:function(b,c,e){d.push({evtname:b,$els:a.isArray(c)?c:[c],handler:a.proxy(e,c)})}},a.fn.ufui=function(a){return a?this.data("ufuiwidget",a):this.data("ufuiwidget")};var g=1;UF.ui={define:function(d,e,h){var i=UF.ui[d]=b(function(b,c){var e=function(){};a.extend(e.prototype,i.prototype,{guid:d+g++,widgetName:d});var h=new e;if("string"==a.type(b))return h.init&&h.init({}),h.root().ufui(h),h.root().find("a").click(function(a){a.preventDefault()}),h.root()[f+d].apply(h.root(),arguments);c&&h.root(c),h.init&&h.init(!b||a.isPlainObject(b)?a.extend2(b||{},h.defaultOpt||{},!0):b);try{h.root().find("a").click(function(a){a.preventDefault()})}catch(j){}return h.root().ufui(h)},e,h);c(i,d)}},a(function(){a(document).on("click mouseup mousedown dblclick mouseover",function(b){a.each(d,function(c,d){d.evtname==b.type&&a.each(d.$els,function(c,e){e[0]===b.target||a.contains(e[0],b.target)||d.handler(b)})})})})}(jQuery),UF.ui.define("button",{tpl:'<<%if(!texttype){%>div class="ufui-btn ufui-btn-<%=icon%> <%if(name){%>ufui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="ufui-text-btn"<%}%><% if(title) {%>title="<%=title%>" data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="ufui-icon-<%=icon%> ufui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="ufui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="ufui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="ufui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))).click(function(c){b.wrapclick(a.click,c)}),b.root().hover(function(){b.root().hasClass("ufui-disabled")||b.root().toggleClass("ufui-hover")}),b},wrapclick:function(a,b){return this.disabled()?void 0:(this.root().trigger("wrapclick"),$.proxy(a,this,b)())},label:function(a){return void 0===a?this.root().find(".ufui-button-label").text():(this.root().find(".ufui-button-label").text(a),this)},disabled:function(a){return void 0===a?this.root().hasClass("ufui-disabled"):(this.root().toggleClass("ufui-disabled",a),this.root().hasClass("ufui-disabled")&&this.root().removeClass("ufui-hover"),this)},active:function(a){return void 0===a?this.root().hasClass("ufui-active"):(this.root().toggleClass("ufui-active",a),this)},mergeWith:function(a){var b=this;b.data("$mergeObj",a),a.ufui().data("$mergeObj",b.root()),$.contains(document.body,a[0])||a.appendTo(b.root()),b.on("click",function(){b.wrapclick(function(){a.ufui().show()})}).register("click",b.root(),function(){a.hide()})}}),function(){var a="combobox",b="ufui-combobox-item",c="ufui-combobox-item-hover",d="ufui-combobox-checked-icon",e="ufui-combobox-item-label";UF.ui.define(a,function(){return{tpl:'<ul class="dropdown-menu ufui-combobox-menu<%if (comboboxName!==\'\') {%> ufui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> ufui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="ufui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="ufui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> ufui-combobox-checked<%}%> ufui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="ufui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(a){var c=this;
$.extend(c._optionAdaptation(a),c._createItemMapping(a.recordStack,a.items),{itemClassName:b,iconClass:d,labelClassName:e}),this._transStack(a),c.root($($.parseTmpl(c.tpl,a))),this.data("options",a).initEvent()},initEvent:function(){var a=this;a.initSelectItem(),this.initItemActive()},initSelectItem:function(){var a=this,c="."+e;a.root().delegate("."+b,"click",function(){var b=$(this),d=b.attr("data-item-index");return a.trigger("comboboxselect",{index:d,label:b.find(c).text(),value:a.data("options").value[d]}).select(d),a.hide(),!1})},initItemActive:function(){var a={mouseenter:"addClass",mouseleave:"removeClass"};$.IE6&&this.root().delegate("."+b,"mouseenter mouseleave",function(b){$(this)[a[b.type]](c)}).one("afterhide",function(){})},select:function(a){var b=this.data("options").itemCount,c=this.data("options").autowidthitem;return c&&!c.length&&(c=this.data("options").items),0==b?null:(0>a?a=b+a%b:a>=b&&(a=b-1),this.trigger("changebefore",c[a]),this._update(a),this.trigger("changeafter",c[a]),null)},selectItemByLabel:function(a){var b=this.data("options").itemMapping,c=this,d=null;!$.isArray(a)&&(a=[a]),$.each(a,function(a,e){return d=b[e],void 0!==d?(c.select(d),!1):void 0})},_transStack:function(a){var b=[],c=-1,d=-1;$.each(a.recordStack,function(e,f){c=a.itemMapping[f],$.isNumeric(c)&&(b.push(c),f==a.selected&&(d=c))}),a.recordStack=b,a.selected=d,b=null},_optionAdaptation:function(a){if(!("itemStyles"in a)){a.itemStyles=[];for(var b=0,c=a.items.length;c>b;b++)a.itemStyles.push("")}return a.autowidthitem=a.autowidthitem||a.items,a.itemCount=a.items.length,a},_createItemMapping:function(a,b){var c={},d={recordStack:[],mapping:{}};return $.each(b,function(a,b){c[b]=a}),d.itemMapping=c,$.each(a,function(a,b){void 0!==c[b]&&(d.recordStack.push(c[b]),d.mapping[b]=c[b])}),d},_update:function(a){var b=this.data("options"),c=[],d=null;$.each(b.recordStack,function(b,d){d!=a&&c.push(d)}),c.unshift(a),c.length>b.recordCount&&(c.length=b.recordCount),b.recordStack=c,b.selected=a,d=$($.parseTmpl(this.tpl,b)),this.root().html(d.html()),d=null,c=null}}}(),"menu")}(),UF.ui.define("modal",{tpl:'<div class="ufui-modal" tabindex="-1" ><div class="ufui-modal-header"><div class="ufui-close" data-hide="modal"></div><h3 class="ufui-title"><%=title%></h3></div><div class="ufui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="ufui-modal-footer"><div class="ufui-modal-tip"></div><%if(oklabel){%><div class="ufui-btn ufui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="ufui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a||{}))),b.data("options",a),a.okFn&&b.on("ok",$.proxy(a.okFn,b)),a.cancelFn&&b.on("beforehide",$.proxy(a.cancelFn,b)),b.root().delegate('[data-hide="modal"]',"click",$.proxy(b.hide,b)).delegate('[data-ok="modal"]',"click",$.proxy(b.ok,b)),$('[data-hide="modal"],[data-ok="modal"]',b.root()).hover(function(){$(this).toggleClass("ufui-hover")})},toggle:function(){var a=this;return a[a.data("isShown")?"hide":"show"]()},show:function(){var a=this;a.trigger("beforeshow"),a.data("isShown")||(a.data("isShown",!0),a.escape(),a.backdrop(function(){a.autoCenter(),a.root().show().focus().trigger("aftershow")}))},showTip:function(a){$(".ufui-modal-tip",this.root()).html(a).fadeIn()},hideTip:function(){$(".ufui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){$.IE6||(this.root().css("margin-left",-(this.root().width()/2)),this.root().css("margin-top",-(this.root().height()/2)))},hide:function(){var a=this;a.trigger("beforehide"),a.data("isShown")&&(a.data("isShown",!1),a.escape(),a.hideModal())},escape:function(){var a=this;a.data("isShown")&&a.data("options").keyboard?a.root().on("keyup",function(b){27==b.which&&a.hide()}):a.data("isShown")||a.root().off("keyup")},hideModal:function(){var a=this;a.root().hide(),a.backdrop(function(){a.removeBackdrop(),a.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(a){var b=this;b.data("isShown")&&b.data("options").backdrop&&(b.$backdrop=$('<div class="ufui-modal-backdrop" />').click("static"==b.data("options").backdrop?$.proxy(b.root()[0].focus,b.root()[0]):$.proxy(b.hide,b))),b.trigger("afterbackdrop"),a&&a()},attachTo:function(a){var b=this;a.data("$mergeObj")||(a.data("$mergeObj",b.root()),a.on("click",function(){b.toggle(a)}),b.data("$mergeObj",a))},ok:function(){var a=this;a.trigger("beforeok"),a.trigger("ok",a)!==!1&&a.hide()},getBodyContainer:function(){return this.root().find(".ufui-modal-body")}}),UF.ui.define("scale",{tpl:'<div class="ufui-scale" unselectable="on"><span class="ufui-scale-hand0"></span><span class="ufui-scale-hand1"></span><span class="ufui-scale-hand2"></span><span class="ufui-scale-hand3"></span><span class="ufui-scale-hand4"></span><span class="ufui-scale-hand5"></span><span class="ufui-scale-hand6"></span><span class="ufui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(a){return a.$doc&&(this.defaultOpt.$doc=a.$doc),a.$wrap&&(this.defaultOpt.$wrap=a.$wrap),this.root($($.parseTmpl(this.tpl,a))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){utils.cssRule("ufui-style-scale",".ufui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.ufui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.ufui-scale .ufui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.ufui-scale .ufui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.ufui-scale .ufui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.ufui-scale .ufui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.ufui-scale .ufui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.ufui-scale .ufui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.ufui-scale .ufui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.ufui-scale .ufui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(a){var b=this,c=b.defaultOpt.$doc;switch(a.type){case"mousedown":var d=a.target||a.srcElement;-1!=d.className.indexOf("ufui-scale-hand")&&(b.dragId=d.className.slice(-1),b.startPos.x=b.prePos.x=a.clientX,b.startPos.y=b.prePos.y=a.clientY,c.bind("mousemove",$.proxy(b._eventHandler,b)));break;case"mousemove":-1!=b.dragId&&(b.updateContainerStyle(b.dragId,{x:a.clientX-b.prePos.x,y:a.clientY-b.prePos.y}),b.prePos.x=a.clientX,b.prePos.y=a.clientY,b.updateTargetElement());break;case"mouseup":if(-1!=b.dragId){b.dragId=-1,b.updateTargetElement();var e=b.data("$scaleTarget");e.parent()&&b.attachTo(b.data("$scaleTarget"))}c.unbind("mousemove",$.proxy(b._eventHandler,b))}},updateTargetElement:function(){var a=this,b=a.root(),c=a.data("$scaleTarget");c.css({width:b.width(),height:b.height()}),a.attachTo(c)},updateContainerStyle:function(a,b){var c,d=this,e=d.root(),f=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=f[a][0]&&(c=parseInt(e.offset().left)+b.x,e.css("left",d._validScaledProp("left",c))),0!=f[a][1]&&(c=parseInt(e.offset().top)+b.y,e.css("top",d._validScaledProp("top",c))),0!=f[a][2]&&(c=e.width()+f[a][2]*b.x,e.css("width",d._validScaledProp("width",c))),0!=f[a][3]&&(c=e.height()+f[a][3]*b.y,e.css("height",d._validScaledProp("height",c)))},_validScaledProp:function(a,b){var c=this.root(),d=this.defaultOpt.$doc,e=function(a,c,d){return a+c>d?d-c:b};switch(b=isNaN(b)?0:b,a){case"left":return 0>b?0:e(b,c.width(),d.width());case"top":return 0>b?0:e(b,c.height(),d.height());case"width":return 0>=b?1:e(b,c.offset().left,d.width());case"height":return 0>=b?1:e(b,c.offset().top,d.height())}},show:function(a){var b=this;a&&b.attachTo(a),b.root().bind("mousedown",$.proxy(b._eventHandler,b)),b.defaultOpt.$doc.bind("mouseup",$.proxy(b._eventHandler,b)),b.root().show(),b.trigger("aftershow")},hide:function(){var a=this;a.root().unbind("mousedown",$.proxy(a._eventHandler,a)),a.defaultOpt.$doc.unbind("mouseup",$.proxy(a._eventHandler,a)),a.root().hide(),a.trigger("afterhide")},attachTo:function(a){var b=this,c=a.offset(),d=b.root(),e=b.defaultOpt.$wrap,f=e.offset();b.data("$scaleTarget",a),b.root().css({position:"absolute",width:a.width(),height:a.height(),left:c.left-f.left-parseInt(e.css("border-left-width"))-parseInt(d.css("border-left-width")),top:c.top-f.top-parseInt(e.css("border-top-width"))-parseInt(d.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UF.ui.define("splitbutton",{tpl:'<div class="ufui-splitbutton <%if (name){%>ufui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="ufui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="ufui-icon-<%=icon%> ufui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="ufui-btn ufui-dropdown-toggle" ><div  unselectable="on" class="ufui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))),b.root().find(".ufui-btn:first").click(function(){b.disabled()||$.proxy(a.click,b)()}),b.root().find(".ufui-dropdown-toggle").click(function(){b.disabled()||b.trigger("arrowclick")}),b.root().hover(function(){b.root().hasClass("ufui-disabled")||b.root().toggleClass("ufui-hover")}),b},wrapclick:function(a,b){return this.disabled()||$.proxy(a,this,b)(),this},disabled:function(a){return void 0===a?this.root().hasClass("ufui-disabled"):(this.root().toggleClass("ufui-disabled",a).find(".ufui-btn").toggleClass("ufui-disabled",a),this)},active:function(a){return void 0===a?this.root().hasClass("ufui-active"):(this.root().toggleClass("ufui-active",a).find(".ufui-btn:first").toggleClass("ufui-active",a),this)},mergeWith:function(a){var b=this;b.data("$mergeObj",a),a.ufui().data("$mergeObj",b.root()),$.contains(document.body,a[0])||a.appendTo(b.root()),b.root().delegate(".ufui-dropdown-toggle","click",function(){b.wrapclick(function(){a.ufui().show()})}),b.register("click",b.root().find(".ufui-dropdown-toggle"),function(){a.hide()})}}),UF.ui.define("tooltip",{tpl:'<div class="ufui-tooltip" unselectable="on" onmousedown="return false"><div class="ufui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="ufui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a||{})))},content:function(a){var b=this,c=$(a.currentTarget).attr("data-original-title");b.root().find(".ufui-tooltip-inner").text(c)},position:function(a){var b=this,c=$(a.currentTarget);b.root().css($.extend({display:"block"},c?{top:c.outerHeight(),left:(c.outerWidth()-b.root().outerWidth())/2}:{}))},show:function(a){if(!$(a.currentTarget).hasClass("ufui-disabled")){var b=this;b.content(a),b.root().appendTo($(a.currentTarget)),b.position(a),b.root().css("display","block")}},hide:function(){var a=this;a.root().css("display","none")},attachTo:function(a){function b(a){var b=this;$.contains(document.body,b.root()[0])||b.root().appendTo(a),b.data("tooltip",b.root()),a.each(function(){$(this).attr("data-original-title")&&$(this).on("mouseenter",$.proxy(b.show,b)).on("mouseleave click",$.proxy(b.hide,b))})}var c=this;"undefined"===$.type(a)?$("[data-original-title]").each(function(a,d){b.call(c,$(d))}):a.data("tooltip")||b.call(c,a)}}),function(){var a="buttoncombobox";UF.ui.define(a,function(){return{defaultOpt:{label:"",title:""},init:function(a){var b=this,c=$.ufuibutton({caret:!0,name:a.comboboxName,title:a.title,text:a.label,click:function(){b.show(this.root())}});b.supper.init.call(b,a),b.on("changebefore",function(a,b){c.ufuibutton("label",b)}),b.data("button",c),b.attachTo(c)},button:function(){return this.data("button")}}}(),"combobox")}(),UF.ui.define("dropmenu",{tmpl:'<ul class="ufui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="ufui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="ufui-dropmenu-checkbox"><i class="ufui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(a){var b=this,c={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,a))).on("click",'li[class!="ufui-disabled ufui-divider ufui-dropdown-submenu"]',function(c){$.proxy(a.click,b,c,$(this).data("value"),$(this))()}).find("li").each(function(d,e){var f=$(this);if(!f.hasClass("ufui-disabled ufui-divider ufui-dropdown-submenu")){var g=a.data[d];$.each(c,function(a){g[a]&&f[a](function(c){$.proxy(g[a],e)(c,g,b.root)})})}})},disabled:function(a){$("li[class!=ufui-divider]",this.root()).each(function(){var b=$(this);a===!0?b.addClass("ufui-disabled"):$.isFunction(a)?b.toggleClass("ufui-disabled",a(li)):b.removeClass("ufui-disabled")})},val:function(a){var b;return $('li[class!="ufui-divider ufui-disabled ufui-dropdown-submenu"]',this.root()).each(function(){var c=$(this);if(void 0===a){if(c.find("em.ufui-dropmenu-checked").length)return b=c.data("value"),!1}else c.find("em").toggleClass("ufui-dropmenu-checked",c.data("value")==a)}),void 0===a?b:void 0},addSubmenu:function(a,b,c){c=c||0;var d=$("li[class!=ufui-divider]",this.root()),e=$('<li class="ufui-dropdown-submenu"><a tabindex="-1" href="#">'+a+"</a></li>").append(b);c>=0&&c<d.length?e.insertBefore(d[c]):0>c?e.insertBefore(d[0]):c>=d.length&&e.appendTo(d)}},"menu"),UF.ui.define("menu",{show:function(a,b,c,d,e){c=c||"position",this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},a?{top:a[c]().top+("right"==b?0:a.outerHeight())-(d||0),left:a[c]().left+("right"==b?a.outerWidth():0)-(e||0)}:{})),this.trigger("aftershow"))},hide:function(a){var b;this.trigger("beforehide")!==!1&&((b=this.root().data("parentmenu"))&&(b.data("parentmenu")||a)&&b.ufui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(a){var b=this;a.data("$mergeObj")||(a.data("$mergeObj",b.root()),a.on("wrapclick",function(){b.show()}),b.register("click",a,function(){b.hide()}),b.data("$mergeObj",a))}}),UF.ui.define("popup",{tpl:'<div class="ufui-dropdown-menu ufui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="ufui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="ufui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(a){return this.root($($.parseTmpl(this.tpl,a))),this},mergeTpl:function(a){return $.parseTmpl(this.tpl,{subtpl:a})},show:function(a,b){b||(b={});var c=b.fnname||"position";this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},a?{top:a[c]().top+("right"==b.dir?0:a.outerHeight())-(b.offsetTop||0),left:a[c]().left+("right"==b.dir?a.outerWidth():0)-(b.offsetLeft||0),position:"absolute"}:{})),this.root().find(".ufui-popup-caret").css({top:b.caretTop||0,left:b.caretLeft||0,position:"absolute"}).addClass(b.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(a,b){var c=this;a.data("$mergeObj")||(a.data("$mergeObj",c.root()),a.on("wrapclick",function(){c.show(a,b)}),c.register("click",a,function(){c.hide()}),c.data("$mergeObj",a))},getBodyContainer:function(){return this.root().find(".ufui-popup-body")}}),UF.ui.define("separator",{tpl:'<div class="ufui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))),b}}),function(){UF.ui.define("toolbar",{tpl:'<div class="ufui-toolbar"  ><div class="ufui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var a=this.root($(this.tpl));this.data("$btnToolbar",a.find(".ufui-btn-toolbar"))},appendToBtnmenu:function(a){var b=this.data("$btnToolbar");a=$.isArray(a)?a:[a],$.each(a,function(a,c){b.append(c)})}})}(),UF.ui.define("file",{tpl:'<div class="ufui-file ufui-file-<%=pers%>" data-path="<%=path%>"><div class="ufui-file-icon">   <i class="ufui-file-icon-<%=type%>"></i>   <span class="ufui-file-pers"></span></div><div class="ufui-file-title"><%=title%></div></div>',defaultOpt:{type:"",title:"",path:"",pers:"wr"},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))),b.root().find(".ufui-file-title").on("focus blur",function(){}),b},editabled:function(a,b){var c=this,d=this.root().find(".ufui-file-title");if(void 0===a)return d.attr("contenteditable");if(a){if(c.renameFlag)return this;var e=!1,f=function(a){return b(d.text()),d.focus().off("blur keydown",g),c.editabled(!1),c.renameFlag=!1,a.preventDefault(),!1},g=function(a){if(console.log("---",a.type,a.keyCode),"blur"==a.type&&!e)return f(a);if("keydown"==a.type){if(27==a.keyCode)e=!0;else if(13==a.keyCode)return f(a)}else if("click"==a.type)return a.preventDefault(),!1};d.addClass("ufui-file-title-editable").attr("contenteditable","true"),c.renameFlag=!0,setTimeout(function(){d.focus(),setTimeout(function(){d.on("keydown click blur",g)},100)},100)}else d.removeClass("ufui-file-title-editable").attr("contenteditable","false"),c.renameFlag=!1;return this},disabled:function(a){return void 0===a?this.root().hasClass("ufui-disabled"):(this.root().toggleClass("ufui-disabled",a),this.root().hasClass("ufui-disabled")&&this.root().removeClass("ufui-hover"),this)},active:function(a){return void 0===a?this.root().hasClass("ufui-active"):(this.root().toggleClass("ufui-active",a),this)},setTitle:function(a){return this.root().find(".ufui-file-title").text(a),this},getTitle:function(){return this.root().find(".ufui-file-title").text()},setType:function(a){return this.root().find(".ufui-file-icon i").attr("class","ufui-file-icon-"+a).attr("style",""),this},getType:function(){var a=this.root().find(".ufui-file-icon i"),b=a.attr("class").match(/ufui-file-icon-([\w]+)(\s|$)/);return b?b[1]:null},setPath:function(a){return this.root().attr("data-path",a),this},getPath:function(){return this.root().attr("data-path")},setPers:function(a){return this.root().addClass("ufui-file-"+(a?"w":"nw")+"r"),this},getPers:function(){var a=this.root(),b=a.hasClass("ufui-file-w-r")||a.hasClass("ufui-file-nw-r"),c=a.hasClass("ufui-file-w-r")||a.hasClass("ufui-file-w-nr");return{write:b,read:c}},setPreviewImg:function(a){var b=this;$('<img src="'+a+'" style="display:none;">').appendTo(document.body).on("load",function(){var c=$(this);b.root().find(".ufui-file-icon i").css({"background-image":'url("'+a+'")',"background-size":c.width()>c.height()?"auto 100%":"100% auto","background-position":"center center","background-repeat":"no-repeat no-repeat","border-radius":"3px",width:"60px",height:"60px",margin:"10px auto 0 auto"}),c.remove()})}}),UF.ui.define("list",{tpl:'<div class="ufui-list"><div class="ufui-list-container"></div></div>',defaultOpt:{sort:"title"},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))).append(b.$list),b.$list=b.root().find(".ufui-list-container"),b._ufItems=[],b},_compare:function(a,b){var c=a.getType(),d=b.getType(),e=a.getTitle(),f=b.getTitle();return"dir"==c&&"dir"!=d?0:"dir"!=c&&"dir"==d?1:c!=d?c>d:e>f},getItem:function(a){for(var b=0;b<this._ufItems.length;b++)if(this._ufItems[b].getPath()==a)return this._ufItems[b];return null},getItems:function(){return this._ufItems},addItem:function(a){var b,c=$.ufuifile(a),d=c.ufui();for(b=0;b<this._ufItems.length;b++){var e=this._ufItems[b];if(this._compare(e,d))break}return b>=this._ufItems.length?this.$list.append(c):c.insertBefore(this._ufItems[b].root()),this._ufItems.splice(b,0,d),this},removeItem:function(a,b){for(var c=0;c<this._ufItems.length;c++){var d=this._ufItems[c];if(d.getPath()==a){this._ufItems.splice(c,1),b?d.active(!1).root().fadeOut(b||0,function(){$(this).remove()}):d.root().remove();break}}return this},clearItems:function(){return $.each(this._ufItems,function(a,b){b.root().remove()}),this._ufItems=[],this},isItemInList:function(a){return this.getItem(a)?!0:!1}}),UF.ui.define("leaf",{tpl:'<li class="ufui-leaf" data-path="<%=path%>">   <div class="ufui-leaf-detail ufui-leaf-detail-closed">       <div class="ufui-leaf-expand"></div>       <div class="ufui-leaf-folder"><i class="ufui-leaf-folder-<%=type%>"></i></div>       <div class="ufui-leaf-title"><%=title%></div>   </div>   <ul class="ufui-tree-branch ufui-tree-branch-closed"></ul></li>',defaultOpt:{type:"dir",title:"",path:"/",pers:"wr"},init:function(a){var b=this;a.path=Utils.regularDirPath(a.path),b.root($($.parseTmpl(b.tpl,a)));var c=b.$detail=b.root().children().eq(0);return b.$branch=b.root().children().eq(1),c.find(".ufui-leaf-expand").on("click",function(){b.expand(c.hasClass("ufui-leaf-detail-opened")?!1:!0)}),b},disabled:function(a){return void 0===a?this.root().hasClass("ufui-disabled"):(this.root().toggleClass("ufui-disabled",a),this.root().hasClass("ufui-disabled")&&this.root().removeClass("ufui-hover"),this)},active:function(a){return void 0===a?this.root().hasClass("ufui-active"):(this.root().toggleClass("ufui-active",a),this)},expand:function(a){a?(this.$detail.removeClass("ufui-leaf-detail-closed").addClass("ufui-leaf-detail-opened"),this.$branch.removeClass("ufui-tree-branch-closed").addClass("ufui-tree-branch-opened")):(this.$detail.removeClass("ufui-leaf-detail-opened").addClass("ufui-leaf-detail-closed"),this.$branch.removeClass("ufui-tree-branch-opened").addClass("ufui-tree-branch-closed"))},_compare:function(a,b){var c=a.getType(),d=b.getType(),e=a.getTitle(),f=b.getTitle();return"dir"==c&&"dir"!=d?0:"dir"!=c&&"dir"==d?1:e>f},setPath:function(a){return this.root().attr("data-path",Utils.regularDirPath(a)),this},getPath:function(){return this.root().attr("data-path")},setType:function(a){return this.$detail.find(".ufui-leaf-folder i").attr("class","ufui-leaf-folder-"+a),this},getType:function(){var a=this.$detail.find(".ufui-leaf-folder i"),b=a.attr("class").match(/ufui-leaf-folder-([\w]+)(\s|$)/);return b?b[1]:null},setTitle:function(a){return this.$detail.find(".ufui-leaf-title").text(a),this},getTitle:function(){return this.$detail.find(".ufui-leaf-title").text()},addChild:function(a){for(var b=this.$branch.children(),c=0;c<b.length&&!this._compare($(b[c]).ufui(),a);c++);return 0==c?this.$branch.prepend(a.root()):$(b[c-1]).after(a.root()),this.expand(!0),this},removeChild:function(a){return a.remove(),this},getChildren:function(){return this.$branch.children()}}),UF.ui.define("tree",{tpl:'<div class="ufui-tree"><ul class="ufui-tree-branch ufui-tree-branch-root"></ul></div>',defaultOpt:{},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))),b.$branch=b.root().find(".ufui-tree-branch"),b._ufItems={},b},disabled:function(a){return void 0===a?this.root().hasClass("ufui-disabled"):(this.root().toggleClass("ufui-disabled",a),this.root().hasClass("ufui-disabled")&&this.root().removeClass("ufui-hover"),this)},active:function(a){return void 0===a?this.root().hasClass("ufui-active"):(this.root().toggleClass("ufui-active",a),this)},_compare:function(a,b){var c=a.getType(),d=b.getType(),e=a.getTitle(),f=b.getTitle();return"dir"==c&&"dir"!=d?0:"dir"!=c&&"dir"==d?1:e>f},getItem:function(a){return this._ufItems[Utils.regularDirPath(a)]},getItems:function(){return this._ufItems},addItem:function(a){var b=a.path,c=$.ufuileaf(a),d=c.ufui(),e=this.getItem(Utils.getParentPath(b));return this._ufItems[b]||(e?e.addChild(d):this.$branch.append(c),this._ufItems[b]=d),this},setRoot:function(a){a.name="Root";var b=$.ufuileaf(a),c=b.ufui();return this.$branch.append(b),this._ufItems[a.path]=c,b.addClass("ufui-tree-leaf-root"),this},removeItem:function(a){var b=this;return a=Utils.regularDirPath(a),b._ufItems[a]&&(b._ufItems[a].root().remove(),delete b._ufItems[a]),this},clearItems:function(){return $.each(this._ufItems,function(a,b){b.root().remove()}),this._ufItems=[],this},isItemInTree:function(a){return this.getItem(a)?!0:!1}}),UF.ui.define("panel",{tpl:'<div class="ufui-panel"  ></div>',defaultOpt:{},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))),b}}),UF.ui.define("message",{tpl:'<div class="ufui-message">   <div class="ufui-message-head"><div class="ufui-message-close"></div></div>   <div class="ufui-message-body">       <div class="ufui-message-icon"><i class="ufui-message-icon-<%=icon%>"></i></div>       <div class="ufui-message-info">           <div class="ufui-message-title"><%=title%></div>           <div class="ufui-message-loadbar"><div class="ufui-message-loadbar-percent"></div></div>       </div>   </div></div>',defaultOpt:{icon:"",title:""},init:function(a){var b=this;return b.root($($.parseTmpl(b.tpl,a))),b.root().hide(),b.$title=b.root().find(".ufui-message-title"),b.$loadbar=b.root().find(".ufui-message-loadbar"),b.loadedPercent=a.loadedPercent||0,b.setLoadedPercent(b.loadedPercent),b.root().find(".ufui-message-close").on("click",function(){b.hide()}),void 0!==a.timeout&&a.timeout>=0&&(b.timer=setTimeout(function(){b.hide()},a.timeout)),b},show:function(){return this.root().fadeIn(400)},hide:function(){return this.root().fadeOut(400)},setIcon:function(a){return this.root().find(".ufui-message-icon i").attr("class","ufui-message-icon-"+a),this},getIcon:function(){var a=this.root().find(".ufui-message-icon i"),b=a.attr("class").match(/ufui-message-icon-([\w]+)(\s|$)/);return b?b[1]:null},setMessage:function(a){return this.$title.text(a),this},getMessage:function(){return this.$title.text()},setLoadedPercent:function(a){return this.root().find(".ufui-message-loadbar-percent").css("width",a+"%"),this},getLoadedPercent:function(){return this.root().find(".ufui-message-loadbar-percent").css("width")},setTimer:function(a){var b=this;return void 0!==a&&clearTimeout(b.timer),a>=0&&(b.timer=setTimeout(function(){b.hide()},a)),this},getTimer:function(){return this.timer}}),$.extend(UFinder,function(){var a={},b={},c={};return{registerUI:function(b,c){$.each(b.split(/\s+/),function(b,d){a[d]=c})},_createContainer:function(a){var b=$('<div class="ufui-container"></div>');return $(Utils.isString(a)?"#"+a:a).append(b),b},_createToolbar:function(b){var c=b.getOption("toolbars"),d=$.ufuitoolbar();if(b.$container.append(d),b.$toolbar=d,c&&c.length){var e=[];$.each(c,function(c,f){$.each(f.split(/\s+/),function(c,d){if("|"==d)$.ufuiseparator&&e.push($.ufuiseparator());else if(a[d]){var f=a[d].call(b,d);f&&e.push(f)}}),e.length&&d.ufui().appendToBtnmenu(e)})}d.append($('<div class="ufui-dialog-container"></div>'))},_createtree:function(b){var c=a.tree.call(b,"list");b.$container.append(c),b.$tree=c},_createlist:function(b){var c=a.list.call(b,"list");b.$container.append(c),b.$list=c},_createMessageHolder:function(b){var c=$('<div class="ufui-message-list"></div>');b.$container.append(c),b.$messageHolder=c;var d={};b.on("showmessage",function(e,f){var g=a.message.call(b,"message",{icon:f.icon||"warning",title:f.title||"",loadedPercent:f.loadedPercent||100,timeout:f.timeout,id:f.id||"m"+(+new Date).toString(36)});f.id&&(d[f.id]=g),c.append(g),g.ufui().show()}),b.on("updatemessage",function(a,b){var c;b.id&&(c=d[b.id])&&c.ufui().setIcon(b.icon).setMessage(b.title).setTimer(b.timeout).setLoadedPercent(b.loadedPercent)}),b.on("hidemessage",function(a,b){var c;(c=d[b.id])&&c.ufui().hide()})},getUFinder:function(a,b){var c=this._createContainer(a),d=this.getFinder(c,b);return d.$container=c,d.on("focus",function(){c.removeClass("ufui-disabled")}).on("blur",function(){c.addClass("ufui-disabled")}),this._createToolbar(d),this._createtree(d),this._createlist(d),this._createMessageHolder(d),d._initDomEvent(),d.fire("ready"),d},delUFinder:function(){},registerWidget:function(a,d,e){b[a]=$.extend2(d,{$root:"",_preventDefault:!1,root:function(a){return this.$root||(this.$root=a)},preventDefault:function(){this._preventDefault=!0},clear:!1}),e&&(c[a]=e)},getWidgetData:function(a){return b[a]},setWidgetBody:function(a,d,e){e._widgetData||Utils.extend(e,{_widgetData:{},getWidgetData:function(a){return this._widgetData[a]},getWidgetCallback:function(a){var b=this;return function(){return c[a].apply(b,[b,d].concat(Array.prototype.slice.call(arguments,0)))}}});var f=b[a];return f?(f=e._widgetData[a],f||(f=b[a],f=e._widgetData[a]="function"==$.type(f)?f:Utils.clone(f)),f.root(d.ufui().getBodyContainer()),f.initContent(e,d),f._preventDefault||f.initEvent(e,d),void(f.width&&d.width(f.width))):null},createEditor:function(){},createToolbar:function(){}}}()),UF.registerUI("open pathparent pathbackward pathforward touch mkdir rename remove",function(a){var b=this,c=$.ufuibutton({icon:a,click:function(c){return b.execCommand(a),c.preventDefault(),!1},title:b.getLang("labelMap")[a]||""});return b.on("selectionchange ready focus blur currentpathchange",function(){var d=b.queryCommandState(a);c.ufui().disabled(-1==d).active(1==d)}),c}),UF.registerUI("list",function(){var a,b,c,d=this,e=$.ufuilist(),f=e.ufui(),g=function(a){var b=d.getCurrentPath();$.each($.isArray(a)?a:[a],function(a,c){if(Utils.getParentPath(c.path)==b){var e=Utils.getPathExt(c.path);if(f.addItem({type:"dir"==c.type?"dir":e,title:c.name,path:c.path,pers:(c.write?"w":"nw")+(c.read?"r":"nr")}),Utils.isImagePath(c.path)){var g=d.getRealPath(c.path);f.getItem(c.path).setPreviewImg(g)}}})},h=function(){var a=[];return e.find(".ufui-file.ufui-active").each(function(b,c){a.push($(c).attr("data-path"))}),a},i=function(){d.setSelectedFiles(h())},j=function(a){e.find(".ufui-file").not(a).each(function(){$(this).ufui().active(!1)})};return e.delegate(".ufui-file","dblclick",function(){var a=$(this).ufui(),b=a.getPath();if("dir"==a.getType()){var c=d.dataTree.getFileInfo(b);c.read&&!c.locked&&d.execCommand("open",b)}else Utils.isImagePath(b)?d.execCommand("lookimage",b):Utils.isCodePath(b)?d.execCommand("lookcode",b):Utils.isWebPagePath(b)||d.execCommand("download",b)}),e.delegate(".ufui-file","click",function(d){if(!b||c!=d.target||d.shiftKey||d.ctrlKey||d.metaKey){b=setTimeout(function(){b=0},500),c=d.target;var e=$(this),f=$(this).ufui(),g=f.active();if(d.shiftKey&&a){var k,l,m,n;for(e.index()>a.index()?(k=a,l=e):(k=e,l=a),n=l.index(),m=k;m.length&&(m.ufui().active(!0),m=m.next(),!(m.index()>n)););i()}else d.ctrlKey||d.metaKey?(f.active(!g),!g&&(a=e),i()):(!g&&h().length>0||g&&h().length>1?(j(e),f.active(!0)):f.active(!g),f.active()&&(a=e),i())}}),e.on("click",function(a){var b=a.target||a.srcElement;b&&b==e.children()[0]&&(j(),i())}),d.on("currentPathChange",function(a,b){e.attr("data-path")!=b&&(e.attr("data-path",b),f.clearItems(),g(d.dataTree.listDirFileInfo(b)))}),d.on("addFiles",function(a,b){g(b)}),d.on("updateFile",function(a,b,c){f.isItemInList(b)&&f.removeItem(b),g(c)}),d.on("removeFiles",function(a,b){$.each($.isArray(b)?b:[b],function(a,b){f.isItemInList(b)&&f.removeItem(b,300)})}),d.on("selectFiles",function(a,b){j(),$.each($.isArray(b)?b:[b],function(a,b){var c=f.getItem(b);c&&c.active(!0)}),i()}),d.on("lockFiles",function(a,b){$.each($.isArray(b)?b:[b],function(a,b){var c=f.getItem(b);c&&c.disabled(!0)})}),d.on("unlockFiles",function(a,b){$.each($.isArray(b)?b:[b],function(a,b){var c=f.getItem(b);c&&c.disabled(!1)})}),d.on("renameFileTitle",function(a,b,c){var e=f.getItem(b);e&&e.editabled(!0,function(a){c(a,function(a){if(!a){var c=d.dataTree.getFileInfo(b);c&&e.setTitle(c.name)}})})}),d.on("newFileTitle",function(a,b,c){var e,h="dir"==b?"新建文件夹":"新建文件",i=d.getCurrentPath()+h;
g({type:b,path:i,name:h,read:!0,write:!0}),e=f.getItem(i),e.editabled(!0,function(a){c(a,function(){f.removeItem(i)})})}),e}),UF.registerUI("message",function(a,b){var c=$.ufuimessage(b),d=b.request;return d&&c.find(".ufui-message-loadbar").on("click",function(){d.pause()}),c}),UF.registerUI("tree",function(){var a=this,b=$.ufuitree(),c=b.ufui(),d=function(a){"dir"==a.type&&(c.isItemInTree(a.path)||c.addItem({type:a.type,title:a.name,path:a.path}))};return b.delegate(".ufui-leaf-expand,.ufui-leaf-folder,.ufui-leaf-title","click",function(){var b=$(this),c=b.parent(),d=c.parent(),e=d.attr("data-path"),f=a.dataTree.getFileInfo(e);f.read&&!a.dataTree.isFileLocked(e)&&(b.hasClass("ufui-leaf-expand")?c.hasClass("ufui-leaf-detail-closed")||a.execCommand("list",e):a.execCommand("open",e))}),a.on("dataReady",function(a,b){c.setRoot({type:b.type,title:"Root",path:b.path})}),a.on("listFile",function(a,b){$.each(b,function(a,b){d(b)})}),a.on("addfiles",function(a,b){$.each($.isArray(b)?b:[b],function(a,b){d(b)})}),a.on("renamefile",function(a,b,e){if("dir"==e.type){var f=c.getItem(b);f&&(c.removeItem(b),d(e))}}),a.on("removefiles",function(a,b){$.each($.isArray(b)?b:[b],function(a,b){c.isItemInTree(b)&&c.removeItem(b)})}),b}),UF.registerUI("upload",function(a){var b=this,c="ufui-btn-upload-"+(+new Date).toString(36),d=$.ufuibutton({icon:a,click:function(){},title:b.getLang("labelMap")[a]||""});return b.on("selectionchange ready focus blur currentpathchange",function(){var c=b.queryCommandState(a);d.ufui().disabled(-1==c).active(1==c),b.webuploader&&(-1==c?b.webuploader.disable():b.webuploader.enable())}),d.attr("id",c),b.on("initUploader",function(){b.webuploader.addButton({id:"#"+c})}),d}),UF.registerUI("lookimage lookcode",function(a){var b,c=this,d=c.getOption("labelMap"),e={title:d&&d[a]||c.getLang("labelMap."+a),url:c.getOption("URL")+"/dialogs/"+a+"/"+a+".js"},f=$.ufuibutton({icon:a,title:this.getLang("labelMap")[a]||""});return Utils.loadFile(document,{src:e.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var d=UF.getWidgetData(a);if(d.buttons){var g=d.buttons.ok;g&&(e.oklabel=g.label||c.getLang("ok"),g.exec&&(e.okFn=function(){return $.proxy(g.exec,null,c,b)()}));var h=d.buttons.cancel;h&&(e.cancellabel=h.label||c.getLang("cancel"),h.exec&&(e.cancelFn=function(){return $.proxy(h.exec,null,c,b)()}))}d.width&&(e.width=d.width),d.height&&(e.height=d.height),b=$.ufuimodal(e),b.attr("id","ufui-dialog-"+a).addClass("ufui-dialog-"+a).find(".ufui-modal-body").addClass("ufui-dialog-"+a+"-body"),b.ufui().on("beforehide",function(){}).on("beforeshow",function(){var d=this.root(),e=null,f=null;d.parent()[0]||c.$container.find(".ufui-dialog-container").append(d),$.IE6&&(e={width:$(window).width(),height:$(window).height()},f=d.parents(".ufui-toolbar")[0].getBoundingClientRect(),d.css({position:"absolute",margin:0,left:(e.width-d.width())/2-f.left,top:100-f.top})),UF.setWidgetBody(a,b,c)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",c.getOption("zIndex")+1).appendTo(c.$container.find(".ufui-dialog-container")),b.css("zIndex",c.getOption("zIndex")+2)}).on("beforeok",function(){}).attachTo(f)}),c.on("selectionchange ready focus blur currentpathchange",function(){var b=c.queryCommandState(a);f.ufui().disabled(-1==b).active(1==b)}),f})}(jQuery,window);